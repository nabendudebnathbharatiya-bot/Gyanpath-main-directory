<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directory Tree | Smart Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Hind Siliguri', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .tree-line { border-left: 1px dashed #475569; margin-left: 1.2rem; padding-left: 1.2rem; }
        
        /* এনিমেশন এবং ফোল্ডিং */
        .node-content { max-height: 0; overflow: hidden; transition: all 0.3s ease-out; opacity: 0; }
        .node-content.open { max-height: 5000px; opacity: 1; }
        .chevron { transition: transform 0.3s; }
        .rotate-90 { transform: rotate(90deg); }
        
        /* সার্চ হাইলাইট (অপশনাল) */
        .highlight { color: #fbbf24; font-weight: bold; }
    </style>
</head>
<body class="min-h-screen">

    <header class="sticky top-0 z-50 bg-slate-900/95 backdrop-blur border-b border-slate-800 px-6 py-4 shadow-xl">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <i class="fa-solid fa-folder-tree text-blue-500 text-xl"></i>
                <h1 class="text-xl font-bold text-white">Project Directory</h1>
            </div>
            <div class="flex gap-2 text-xs">
                <button onclick="expandAll()" class="px-3 py-1.5 bg-slate-800 border border-slate-700 rounded hover:bg-slate-700">Expand All</button>
                <button onclick="collapseAll()" class="px-3 py-1.5 bg-slate-800 border border-slate-700 rounded hover:bg-slate-700">Collapse All</button>
            </div>
        </div>
    </header>

    

    <main class="max-w-4xl mx-auto p-6">
        <div class="mb-6 relative">
            <i class="fa-solid fa-magnifying-glass absolute left-4 top-3.5 text-slate-500"></i>
            <input type="text" id="searchBox" onkeyup="filterTree()" 
                placeholder="Category, Sub-category বা App-এর নাম দিয়ে খুঁজুন..." 
                class="w-full bg-slate-800 border border-slate-700 text-white pl-12 pr-4 py-3 rounded-xl focus:outline-none focus:border-blue-500 transition shadow-lg">
        </div>

        <div id="tree-root" class="bg-slate-900 border border-slate-800 rounded-2xl p-6 min-h-[400px]">
            <p class="text-center text-slate-500 mt-10">Loading...</p>
        </div>
    </main>

    <script>
        let allData = [];

        async function initTree() {
            try {
                const response = await fetch('app_data.json');
                allData = await response.json();
                renderTree(allData);
            } catch (error) { console.error(error); }
        }

        function renderTree(data) {
            const container = document.getElementById('tree-root');
            const structure = {};
            
            // ডাটা গ্রুপিং
            data.forEach(item => {
                const cat = item.category || 'Uncategorized';
                const sub = item.sub_category || 'General';
                if (!structure[cat]) structure[cat] = {};
                if (!structure[cat][sub]) structure[cat][sub] = [];
                structure[cat][sub].push(item);
            });

            let html = '';
            let catIndex = 0;

            for (const [category, subcats] of Object.entries(structure)) {
                catIndex++;
                html += `
                <div class="tree-node mb-2" id="cat-node-${catIndex}">
                    <div onclick="toggleNode('cat-content-${catIndex}')" class="flex items-center gap-3 cursor-pointer p-2 hover:bg-slate-800 rounded-lg transition select-none">
                        <i id="icon-cat-${catIndex}" class="fa-solid fa-chevron-right text-slate-500 text-xs chevron"></i>
                        <i class="fa-solid fa-folder text-yellow-500"></i>
                        <span class="font-bold text-lg text-slate-200 search-cat">${category}</span>
                    </div>

                    <div id="cat-content-${catIndex}" class="node-content tree-line">
                `;

                let subIndex = 0;
                for (const [subcategory, apps] of Object.entries(subcats)) {
                    subIndex++;
                    html += `
                        <div class="tree-subnode mt-2" id="sub-node-${catIndex}-${subIndex}">
                            <div onclick="toggleNode('sub-content-${catIndex}-${subIndex}')" class="flex items-center gap-3 cursor-pointer p-2 hover:bg-slate-800/50 rounded-lg transition select-none">
                                <i id="icon-sub-${catIndex}-${subIndex}" class="fa-solid fa-chevron-right text-slate-600 text-xs chevron"></i>
                                <i class="fa-solid fa-folder-open text-blue-400"></i>
                                <span class="font-semibold text-slate-300 search-sub">${subcategory}</span>
                            </div>

                            <div id="sub-content-${catIndex}-${subIndex}" class="node-content tree-line">
                    `;

                    apps.forEach(app => {
                        html += `
                            <a href="${app.link}" target="_blank" class="app-node block mt-1 p-2 rounded-lg hover:bg-slate-800 border border-transparent hover:border-slate-700 transition flex items-center justify-between group">
                                <div class="flex items-center gap-3">
                                    <img src="${app.image}" class="w-6 h-6 rounded object-cover">
                                    <span class="text-sm text-slate-300 group-hover:text-white search-app">${app.name}</span>
                                </div>
                                <span class="text-[10px] text-slate-600 font-mono">ID: ${app.id}</span>
                            </a>
                        `;
                    });
                    html += `</div></div>`;
                }
                html += `</div></div>`;
            }
            container.innerHTML = html;
        }

        // --- স্মার্ট সার্চ লজিক ---
        function filterTree() {
            const input = document.getElementById('searchBox').value.toLowerCase();
            const catNodes = document.querySelectorAll('.tree-node');

            catNodes.forEach(catNode => {
                // ১. ক্যাটাগরির নাম চেক
                const catName = catNode.querySelector('.search-cat').innerText.toLowerCase();
                const isCatMatch = catName.includes(input);
                
                let isAnySubVisible = false;

                // সাব-ক্যাটাগরি লুপ
                const subNodes = catNode.querySelectorAll('.tree-subnode');
                subNodes.forEach(subNode => {
                    // ২. সাব-ক্যাটাগরির নাম চেক
                    const subName = subNode.querySelector('.search-sub').innerText.toLowerCase();
                    const isSubMatch = subName.includes(input);
                    
                    let isAnyAppVisible = false;

                    // অ্যাপ লুপ
                    const appNodes = subNode.querySelectorAll('.app-node');
                    appNodes.forEach(appNode => {
                        // ৩. অ্যাপের নাম চেক
                        const appName = appNode.querySelector('.search-app').innerText.toLowerCase();
                        const isAppMatch = appName.includes(input);

                        // লজিক: যদি অ্যাপ ম্যাচ করে অথবা প্যারেন্ট (Sub/Cat) ম্যাচ করে তবে দেখাবে
                        if (isAppMatch || isSubMatch || isCatMatch) {
                            appNode.style.display = "flex";
                            isAnyAppVisible = true;
                        } else {
                            appNode.style.display = "none";
                        }
                    });

                    // সাব-ক্যাটাগরি ডিসপ্লে লজিক
                    if (isAnyAppVisible || isSubMatch || isCatMatch) {
                        subNode.style.display = "block";
                        isAnySubVisible = true;
                        // সার্চ করার সময় সাব-ফোল্ডার খুলে দেওয়া
                        if (input !== "") {
                            subNode.querySelector('.node-content').classList.add('open');
                            const icon = subNode.querySelector('.chevron');
                            if(icon) icon.classList.add('rotate-90');
                        }
                    } else {
                        subNode.style.display = "none";
                    }
                });

                // ক্যাটাগরি ডিসপ্লে লজিক
                if (isAnySubVisible || isCatMatch) {
                    catNode.style.display = "block";
                    // সার্চ করার সময় মেইন ফোল্ডার খুলে দেওয়া
                    if (input !== "") {
                        catNode.querySelector('.node-content').classList.add('open');
                        const icon = catNode.querySelector('.chevron');
                        if(icon) icon.classList.add('rotate-90');
                    }
                } else {
                    catNode.style.display = "none";
                }
            });
        }

        function toggleNode(id) {
            const element = document.getElementById(id);
            // আইকন আইডি বের করা (একটু ট্রিকি, তাই প্যারেন্ট থেকে খোঁজা হচ্ছে)
            const parent = element.parentElement; 
            const icon = parent.querySelector('.chevron');

            if (element.classList.contains('open')) {
                element.classList.remove('open');
                if(icon) icon.classList.remove('rotate-90');
            } else {
                element.classList.add('open');
                if(icon) icon.classList.add('rotate-90');
            }
        }

        function expandAll() {
            document.querySelectorAll('.node-content').forEach(el => el.classList.add('open'));
            document.querySelectorAll('.chevron').forEach(el => el.classList.add('rotate-90'));
        }

        function collapseAll() {
            document.querySelectorAll('.node-content').forEach(el => el.classList.remove('open'));
            document.querySelectorAll('.chevron').forEach(el => el.classList.remove('rotate-90'));
            // সার্চ বক্স ক্লিয়ার হলে সব রিসেট করার জন্য ফিল্টার আবার কল করা যেতে পারে
            if(document.getElementById('searchBox').value === "") filterTree();
        }

        window.onload = initTree;
    </script>
</body>
</html>